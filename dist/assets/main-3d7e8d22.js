(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();function c(r){if(!r||typeof r!="string")return[];const t=/https?:\/\/[^\s]+/g;return r.match(t)||[]}function l(r){const t=c(r);return t.length>0?t[0]:null}async function u(r){if(!r)throw new Error("链接不能为空");const t=`https://api.guijianpan.com/waterRemoveDetail/xxmQsyByAk?ak=7c683460fa194354864f8a8a378ae8aa&link=${encodeURIComponent(r)}`;try{const s=await fetch(t);if(!s.ok)throw new Error(`API请求失败: ${s.status} ${s.statusText}`);const o=await s.json();if(o.code!=="10000"||!o.content)throw new Error(o.msg||"解析失败");return{cover:o.content.cover,url:o.content.url,title:o.content.title}}catch(s){throw new Error(`解析失败: ${s.message}`)}}async function d(r){if(!r)return!1;try{return await navigator.clipboard.writeText(r),!0}catch{return f(r)}}function f(r){const t=document.createElement("textarea");t.value=r,t.style.top="0",t.style.left="0",t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();try{const s=document.execCommand("copy");return document.body.removeChild(t),s}catch{return document.body.removeChild(t),!1}}async function p(r,t){if(!r)throw new Error("视频URL不能为空");return await h(r,t)}async function h(r,t){return new Promise((s,o)=>{try{const e=new XMLHttpRequest;e.open("GET",r,!0),e.responseType="blob",e.setRequestHeader("Referer","https://www.iesdouyin.com"),e.setRequestHeader("Origin","https://www.iesdouyin.com"),e.setRequestHeader("User-Agent","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"),e.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"),e.setRequestHeader("Accept-Language","zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"),e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("Pragma","no-cache"),e.onload=function(){if(e.status===200)try{const n=e.response,a=document.createElement("a");a.href=URL.createObjectURL(n);let i="video.mp4";t&&(i=t.replace(/[/\\?%*:|"<>]/g,"-")+".mp4"),a.download=i,a.style.display="none",a.referrerPolicy="no-referrer",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href),s(!0)}catch(n){o(new Error("创建下载链接失败: "+n.message))}else e.status===403?o(new Error("服务器拒绝访问（可能是防盗链保护）")):o(new Error(`HTTP错误: ${e.status} ${e.statusText}`))},e.onerror=function(){o(new Error("网络错误，请检查连接"))},e.send()}catch(e){o(new Error("初始化下载请求失败: "+e.message))}})}const{createApp:m}=Vue,g=m({data(){return{username:"",password:"",isLoggedIn:!1,videoText:"",videoData:null,isLoading:!1,error:""}},methods:{login(){this.username==="tsyouyou"&&this.password==="bomits"?(this.isLoggedIn=!0,localStorage.setItem("isLoggedIn","true")):alert("用户名或密码错误")},async parseVideo(){if(this.videoData=null,this.error="",!this.videoText.trim()){this.error="请输入包含链接的文本";return}const r=l(this.videoText);if(!r){this.error="未找到有效的链接";return}this.isLoading=!0;try{this.videoData=await u(r)}catch(t){this.error=t.message}finally{this.isLoading=!1}},async copyText(r){const t=await d(r);alert(t?"复制成功":"复制失败")},async downloadVideo(){if(!this.videoData||!this.videoData.url){alert("没有可下载的视频");return}try{await p(this.videoData.url,this.videoData.title),alert("视频下载已尝试启动。如果未自动下载，请检查浏览器的下载管理器或尝试复制地址手动下载。")}catch(r){alert(`下载失败: ${r.message}`)}},checkLoginStatus(){localStorage.getItem("isLoggedIn")==="true"&&(this.isLoggedIn=!0)}},mounted(){this.checkLoginStatus()}}).mount("#app");window.app=g;
