(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();function i(t){if(!t||typeof t!="string")return[];const e=/https?:\/\/[^\s]+/g;return t.match(e)||[]}function c(t){const e=i(t);return e.length>0?e[0]:null}async function l(t){if(!t)throw new Error("链接不能为空");const e=`https://api.guijianpan.com/waterRemoveDetail/xxmQsyByAk?ak=7c683460fa194354864f8a8a378ae8aa&link=${encodeURIComponent(t)}`;try{const r=await fetch(e);if(!r.ok)throw new Error(`API请求失败: ${r.status} ${r.statusText}`);const n=await r.json();if(n.code!=="10000"||!n.content)throw new Error(n.msg||"解析失败");return{cover:n.content.cover,url:n.content.url,title:n.content.title}}catch(r){throw new Error(`解析失败: ${r.message}`)}}async function d(t){if(!t)return!1;try{return await navigator.clipboard.writeText(t),!0}catch{return u(t)}}function u(t){const e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select();try{const r=document.execCommand("copy");return document.body.removeChild(e),r}catch{return document.body.removeChild(e),!1}}async function f(t,e){if(!t)throw new Error("视频URL不能为空");try{const r=document.createElement("a");r.href=t;let n="video.mp4";return e&&(n=e.replace(/[/\\?%*:|"<>]/g,"-")+".mp4"),r.download=n,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),!0}catch{try{return await h(t,e)}catch(n){throw new Error(`下载失败: ${n.message}`)}}}async function h(t,e){const r=await fetch(t);if(!r.ok)throw r.status===403?new Error('视频服务器禁止直接下载（防盗链保护）。请复制无水印地址，在视频播放页面中右键点击视频并选择"另存为"来保存视频。'):new Error(`无法获取视频: ${r.status} ${r.statusText}`);const n=await r.blob(),o=document.createElement("a");o.href=URL.createObjectURL(n);let s="video.mp4";return e&&(s=e.replace(/[/\\?%*:|"<>]/g,"-")+".mp4"),o.download=s,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href),!0}const{createApp:m}=Vue,p=m({data(){return{username:"",password:"",isLoggedIn:!1,videoText:"",videoData:null,isLoading:!1,error:""}},methods:{login(){this.username==="tsyouyou"&&this.password==="bomits"?(this.isLoggedIn=!0,localStorage.setItem("isLoggedIn","true")):alert("用户名或密码错误")},async parseVideo(){if(this.videoData=null,this.error="",!this.videoText.trim()){this.error="请输入包含链接的文本";return}const t=c(this.videoText);if(!t){this.error="未找到有效的链接";return}this.isLoading=!0;try{this.videoData=await l(t)}catch(e){this.error=e.message}finally{this.isLoading=!1}},async copyText(t){const e=await d(t);alert(e?"复制成功":"复制失败")},async downloadVideo(){if(!this.videoData||!this.videoData.url){alert("没有可下载的视频");return}try{await f(this.videoData.url,this.videoData.title),alert("已尝试触发下载。如果未自动下载，请复制无水印地址并在新页面中手动保存视频。")}catch(t){alert(`下载失败: ${t.message}`)}},checkLoginStatus(){localStorage.getItem("isLoggedIn")==="true"&&(this.isLoggedIn=!0)}},mounted(){this.checkLoginStatus()}}).mount("#app");window.app=p;
