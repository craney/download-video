(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();function c(t){if(!t||typeof t!="string")return[];const e=/https?:\/\/[^\s]+/g;return t.match(e)||[]}function l(t){const e=c(t);return e.length>0?e[0]:null}async function u(t){if(!t)throw new Error("链接不能为空");const e=`https://api.guijianpan.com/waterRemoveDetail/xxmQsyByAk?ak=7c683460fa194354864f8a8a378ae8aa&link=${encodeURIComponent(t)}`;try{const r=await fetch(e);if(!r.ok)throw new Error(`API请求失败: ${r.status} ${r.statusText}`);const s=await r.json();if(s.code!=="10000"||!s.content)throw new Error(s.msg||"解析失败");return{cover:s.content.cover,url:s.content.url,title:s.content.title}}catch(r){throw new Error(`解析失败: ${r.message}`)}}async function d(t){if(!t)return!1;try{return await navigator.clipboard.writeText(t),!0}catch{return f(t)}}function f(t){const e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select();try{const r=document.execCommand("copy");return document.body.removeChild(e),r}catch{return document.body.removeChild(e),!1}}async function p(t,e){if(!t)throw new Error("视频URL不能为空");return await h(t,e)}async function h(t,e){try{const r=new XMLHttpRequest;return new Promise((s,o)=>{r.open("GET",t,!0),r.responseType="blob",r.setRequestHeader("Referer","https://www.iesdouyin.com"),r.setRequestHeader("User-Agent",navigator.userAgent),r.onload=function(){if(r.status===200)try{const n=r.response,a=document.createElement("a");a.href=URL.createObjectURL(n);let i="video.mp4";e&&(i=e.replace(/[/\\?%*:|"<>]/g,"-")+".mp4"),a.download=i,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href),s(!0)}catch(n){o(new Error("创建下载链接失败: "+n.message))}else r.status===403?o(new Error("视频服务器禁止访问（防盗链保护）。请复制无水印地址手动下载。")):o(new Error(`无法获取视频: ${r.status} ${r.statusText}`))},r.onerror=function(){o(new Error("网络错误，请检查连接后重试"))},r.send()})}catch(r){throw new Error("下载失败: "+r.message)}}const{createApp:m}=Vue,y=m({data(){return{username:"",password:"",isLoggedIn:!1,videoText:"",videoData:null,isLoading:!1,error:""}},methods:{login(){this.username==="tsyouyou"&&this.password==="bomits"?(this.isLoggedIn=!0,localStorage.setItem("isLoggedIn","true")):alert("用户名或密码错误")},async parseVideo(){if(this.videoData=null,this.error="",!this.videoText.trim()){this.error="请输入包含链接的文本";return}const t=l(this.videoText);if(!t){this.error="未找到有效的链接";return}this.isLoading=!0;try{this.videoData=await u(t)}catch(e){this.error=e.message}finally{this.isLoading=!1}},async copyText(t){const e=await d(t);alert(e?"复制成功":"复制失败")},async downloadVideo(){if(!this.videoData||!this.videoData.url){alert("没有可下载的视频");return}try{await p(this.videoData.url,this.videoData.title),alert("视频下载已尝试启动。如果未自动下载，请检查浏览器的下载管理器或尝试复制地址手动下载。")}catch(t){alert(`下载失败: ${t.message}`)}},checkLoginStatus(){localStorage.getItem("isLoggedIn")==="true"&&(this.isLoggedIn=!0)}},mounted(){this.checkLoginStatus()}}).mount("#app");window.app=y;
