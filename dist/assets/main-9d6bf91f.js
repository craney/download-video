(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();function s(r){if(!r||typeof r!="string")return[];const e=/https?:\/\/[^\s]+/g;return r.match(e)||[]}function c(r){const e=s(r);return e.length>0?e[0]:null}async function l(r){if(!r)throw new Error("链接不能为空");const e=`https://api.guijianpan.com/waterRemoveDetail/xxmQsyByAk?ak=7c683460fa194354864f8a8a378ae8aa&link=${encodeURIComponent(r)}`;try{const t=await fetch(e);if(!t.ok)throw new Error(`API请求失败: ${t.status} ${t.statusText}`);const o=await t.json();if(o.code!=="10000"||!o.content)throw new Error(o.msg||"解析失败");return{cover:o.content.cover,url:o.content.url,title:o.content.title}}catch(t){throw new Error(`解析失败: ${t.message}`)}}async function d(r){if(!r)return!1;try{return await navigator.clipboard.writeText(r),!0}catch{return u(r)}}function u(r){const e=document.createElement("textarea");e.value=r,e.style.top="0",e.style.left="0",e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select();try{const t=document.execCommand("copy");return document.body.removeChild(e),t}catch{return document.body.removeChild(e),!1}}async function f(r,e){if(!r)throw new Error("视频URL不能为空");try{return await m(r,e)}catch(t){console.log("No-referrer方式下载失败，尝试传统方式:",t.message);try{return await h(r,e)}catch(o){throw console.log("传统方式下载失败:",o.message),new Error(`下载失败: ${t.message}`)}}}async function m(r,e){try{const t=document.createElement("a");t.href=r,t.referrerPolicy="no-referrer";let o="video.mp4";return e&&(o=e.replace(/[/\\?%*:|"<>]/g,"-")+".mp4"),t.download=o,t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t),!0}catch(t){throw new Error("No-referrer方式下载失败: "+t.message)}}async function h(r,e){const t=document.createElement("a");t.href=r;let o="video.mp4";return e&&(o=e.replace(/[/\\?%*:|"<>]/g,"-")+".mp4"),t.download=o,t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t),!0}const{createApp:p}=Vue,y=p({data(){return{username:"",password:"",isLoggedIn:!1,videoText:"",videoData:null,isLoading:!1,error:""}},methods:{login(){this.username==="tsyouyou"&&this.password==="bomits"?(this.isLoggedIn=!0,localStorage.setItem("isLoggedIn","true")):alert("用户名或密码错误")},async parseVideo(){if(this.videoData=null,this.error="",!this.videoText.trim()){this.error="请输入包含链接的文本";return}const r=c(this.videoText);if(!r){this.error="未找到有效的链接";return}this.isLoading=!0;try{this.videoData=await l(r)}catch(e){this.error=e.message}finally{this.isLoading=!1}},async copyText(r){const e=await d(r);alert(e?"复制成功":"复制失败")},async downloadVideo(){if(!this.videoData||!this.videoData.url){alert("没有可下载的视频");return}try{await f(this.videoData.url,this.videoData.title),alert("视频下载已尝试启动。如果未自动下载，请检查浏览器的下载管理器或尝试复制地址手动下载。")}catch(r){alert(`下载失败: ${r.message}`)}},checkLoginStatus(){localStorage.getItem("isLoggedIn")==="true"&&(this.isLoggedIn=!0)}},mounted(){this.checkLoginStatus()}}).mount("#app");window.app=y;
