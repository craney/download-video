(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();function s(t){if(!t||typeof t!="string")return[];const e=/https?:\/\/[^\s]+/g;return t.match(e)||[]}function c(t){const e=s(t);return e.length>0?e[0]:null}async function d(t){if(!t)throw new Error("链接不能为空");const e=`https://api.guijianpan.com/waterRemoveDetail/xxmQsyByAk?ak=7c683460fa194354864f8a8a378ae8aa&link=${encodeURIComponent(t)}`;try{const r=await fetch(e);if(!r.ok)throw new Error(`API请求失败: ${r.status} ${r.statusText}`);const n=await r.json();if(n.code!=="10000"||!n.content)throw new Error(n.msg||"解析失败");return{cover:n.content.cover,url:n.content.url,title:n.content.title}}catch(r){throw new Error(`解析失败: ${r.message}`)}}async function l(t){if(!t)return!1;try{return await navigator.clipboard.writeText(t),!0}catch{return u(t)}}function u(t){const e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select();try{const r=document.execCommand("copy");return document.body.removeChild(e),r}catch{return document.body.removeChild(e),!1}}async function f(t,e){if(!t)throw new Error("视频URL不能为空");try{return await h(t,e)}catch(r){try{return await m(t,e)}catch{throw new Error(`下载失败: ${r.message}`)}}}async function h(t,e){try{const r=await fetch(t,{method:"GET",headers:{Referer:"https://www.iesdouyin.com","User-Agent":navigator.userAgent}});if(!r.ok)throw r.status===403?new Error("视频服务器禁止直接访问（防盗链保护）。请尝试复制无水印地址手动下载。"):new Error(`无法获取视频: ${r.status} ${r.statusText}`);const n=await r.blob(),o=document.createElement("a");o.href=URL.createObjectURL(n);let a="video.mp4";return e&&(a=e.replace(/[/\\?%*:|"<>]/g,"-")+".mp4"),o.download=a,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(o.href),!0}catch(r){throw r.name==="TypeError"&&r.message.includes("fetch")?new Error("由于浏览器安全策略限制，无法直接下载该视频。请复制无水印地址手动下载。"):r}}async function m(t,e){const r=document.createElement("a");r.href=t;let n="video.mp4";return e&&(n=e.replace(/[/\\?%*:|"<>]/g,"-")+".mp4"),r.download=n,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),!0}const{createApp:p}=Vue,y=p({data(){return{username:"",password:"",isLoggedIn:!1,videoText:"",videoData:null,isLoading:!1,error:""}},methods:{login(){this.username==="tsyouyou"&&this.password==="bomits"?(this.isLoggedIn=!0,localStorage.setItem("isLoggedIn","true")):alert("用户名或密码错误")},async parseVideo(){if(this.videoData=null,this.error="",!this.videoText.trim()){this.error="请输入包含链接的文本";return}const t=c(this.videoText);if(!t){this.error="未找到有效的链接";return}this.isLoading=!0;try{this.videoData=await d(t)}catch(e){this.error=e.message}finally{this.isLoading=!1}},async copyText(t){const e=await l(t);alert(e?"复制成功":"复制失败")},async downloadVideo(){if(!this.videoData||!this.videoData.url){alert("没有可下载的视频");return}try{await f(this.videoData.url,this.videoData.title),alert("视频下载已尝试启动。如果未自动下载，请检查浏览器的下载管理器或尝试复制地址手动下载。")}catch(t){alert(`下载失败: ${t.message}`)}},checkLoginStatus(){localStorage.getItem("isLoggedIn")==="true"&&(this.isLoggedIn=!0)}},mounted(){this.checkLoginStatus()}}).mount("#app");window.app=y;
